CREATE TABLE users (
    id VARCHAR(50) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50), -- e.g., 'Admin', 'Teacher'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE batch (
    batch_id SERIAL PRIMARY KEY, -- Auto-incrementing integer
    batch_name VARCHAR(50) NOT NULL,
    start_year SMALLINT NOT NULL,
    end_year SMALLINT NOT NULL,
    type VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE student (
    student_id VARCHAR(50) PRIMARY KEY,
    batch_id INT REFERENCES batch(batch_id), -- Foreign Key to Batch
    student_name VARCHAR(100) NOT NULL,
    dob DATE,
    grade VARCHAR(20),
    community VARCHAR(50),
    enrollment_year SMALLINT,
    course VARCHAR(100),
    branch VARCHAR(100),
    student_mobile VARCHAR(15), -- Changed from INT to VARCHAR
    aadhar_no VARCHAR(20),      -- Changed from INT to VARCHAR (12 digits)
    apaar_id VARCHAR(20),       -- Changed from INT to VARCHAR
    email VARCHAR(255),
    photo_url VARCHAR(255),     -- Storing path to photo
    school_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE parent_info (
    student_id VARCHAR(50) PRIMARY KEY REFERENCES student(student_id) ON DELETE CASCADE,
    guardian_name VARCHAR(100),
    father_name VARCHAR(100),
    mother_name VARCHAR(100),
    -- Handling multivalue using Arrays (Postgres specific)
    sibling_names TEXT[], 
    guardian_occupation VARCHAR(100),
    father_occupation VARCHAR(100),
    mother_occupation VARCHAR(100),
    sibling_grades TEXT[],
    guardian_contact VARCHAR(15), -- Changed from INT
    mother_contact VARCHAR(15),   -- Changed from INT
    father_contact VARCHAR(15),   -- Changed from INT
    sibling_schools TEXT[],
    sibling_colleges TEXT[],
    guardian_email VARCHAR(255),
    mother_email VARCHAR(255),
    father_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE tenth_mark (
    student_id VARCHAR(50) PRIMARY KEY REFERENCES student(student_id) ON DELETE CASCADE,
    school_name VARCHAR(255),
    year_of_passing SMALLINT,
    board_of_study VARCHAR(50),
    english_marks INT,
    tamil_marks INT,
    hindi_marks INT,
    maths_marks INT,
    science_marks INT,
    social_science_marks INT,
    total_marks INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE twelfth_mark (
    student_id VARCHAR(50) PRIMARY KEY REFERENCES student(student_id) ON DELETE CASCADE,
    school_name VARCHAR(255),
    year_of_passing SMALLINT,
    board_of_study VARCHAR(50),
    english_marks INT,
    physics_marks INT,
    maths_marks INT,
    chemistry_marks INT,
    biology_marks INT,
    computer_science_marks INT,
    tamil_marks INT,
    total_marks INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE entrance_exams (
    exam_id SERIAL PRIMARY KEY, -- Surrogate key needed
    student_id VARCHAR(50) REFERENCES student(student_id) ON DELETE CASCADE,
    exam_name VARCHAR(100),
    physics_marks INT,
    chemistry_marks INT,
    maths_marks INT,
    biology_marks INT,
    total_marks INT,
    community_rank INT,
    overall_rank INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- Ensure one student doesn't have duplicate entries for the same exam name
    UNIQUE (student_id, exam_name) 
);


CREATE TABLE counselling_detail (
    counselling_id SERIAL PRIMARY KEY,
    student_id VARCHAR(50) REFERENCES student(student_id) ON DELETE CASCADE,
    counseling_forum VARCHAR(100),
    round_number INT,
    college_allotted VARCHAR(255),
    year_of_completion SMALLINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE daily_test (
    test_id SERIAL PRIMARY KEY, -- Changed from simple INT to Serial PK
    student_id VARCHAR(50) REFERENCES student(student_id) ON DELETE CASCADE,
    grade INT,
    branch VARCHAR(100),
    test_date DATE,
    subject VARCHAR(100),
    unit_name VARCHAR(100),
    total_marks INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE mock_test (
    test_id SERIAL PRIMARY KEY,
    student_id VARCHAR(50) REFERENCES student(student_id) ON DELETE CASCADE,
    grade INT,
    branch VARCHAR(100),
    test_date DATE,
    maths_marks INT,
    physics_marks INT,
    biology_marks INT,
    chemistry_marks INT,
    -- Handling multivalue units
    maths_unit_names TEXT[],
    chemistry_unit_names TEXT[],
    biology_unit_names TEXT[],
    physics_unit_names TEXT[],
    total_marks INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE achievers (
    achievement_id SERIAL PRIMARY KEY,
    student_id VARCHAR(50) REFERENCES student(student_id) ON DELETE CASCADE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);